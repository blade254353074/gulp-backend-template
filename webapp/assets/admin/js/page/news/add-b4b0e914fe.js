$(function(){function e(){return o.getContent()}var a=$("#imageGallery"),t=$("#imageUpload"),n=t.parent("a");t.ajaxfileupload({action:"/image/upload",onStart:function(){t.prop("diaabled",!0),n.addClass("sending disabled")},onComplete:function(e){n.removeClass("sending disabled"),e.state&&a.html('<img src="'+e.url+'" class="img-thumbnail upload-data-img">')}});var o=UM.getEditor("ueditor");$("#newsSubmit").on("click",function(a){a.preventDefault();var t=$(this),n=!0,o={};$(".upload-data").each(function(e,a){var t=$(a),d=t.val().trim();return""==d?void(n=!1):void(o[t.attr("name")]=d)}),$(".upload-data-img").each(function(e,a){var t=$(a),d=t.attr("src").trim();return""==d?void(n=!1):void(o.fnewsCover?o.fnewsCover+=";"+d:o.fnewsCover=d)}),0===$(".upload-data-img").length&&(n=!1);var d=e();return d?o.fnewsContent=d:n=!1,n?(console.log(o),t.prop("disabled",!0).text("正在提交").addClass("sending"),void $.ajax({url:"/keeper/fnews/add",type:"POST",dataType:"json",data:o}).fail(function(){alert("提交失败, 请重试"),t.prop("disabled",!1).text("提交新闻").removeClass("sending"),console.log("error")}).done(function(e){e.state?(t.text("提交成功").removeClass("sending"),console.log("success")):(alert("提交失败"),t.text("提交表单").removeClass("sending").prop("disabled",!1))})):void alert("信息未填写完整")})});