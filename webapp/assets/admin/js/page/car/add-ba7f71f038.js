$(function(){function t(){return s.getContent()}var e=$("#seriesSelect"),a=$("#submit");e.on("change",function(){a.prop("disabled",!this.value)});var n=$("#imageGallery"),o=$("#imageUpload"),r=o.parent("a"),i=0;o.ajaxfileupload({action:"/image/upload",onStart:function(){o.prop("diaabled",!0),r.addClass("sending disabled")},onComplete:function(t){9>i&&(o.prop("disabled",!1),r.removeClass("disabled")),r.removeClass("sending"),t.state&&(n.append('<img src="'+t.url+'" class="img-thumbnail upload-data-img">'),i++)}});var d=$("#carVerList"),l=1;$("#carVerAdd").on("click",function(t){t.preventDefault(),html='<tr><td><input name="carverList['+l+'].carVerInfo" type="text" class="form-control upload-data"></td><td><input name="carverList['+l+'].carVerLink" type="text" class="form-control upload-data" placeholder="http://www.xxx.com"></td><td><input name="carverList['+l+'].carPriceDiff" type="text" class="form-control upload-data" placeholder="-23.0"></td><td><button class="delete btn btn-default btn-sm"><span class="icon icon-remove"></span></button></td></tr>',l++,d.append(html)}),d.on("click",".delete",function(t){t.preventDefault(),$(this).closest("tr").remove()});var s=UM.getEditor("ueditor");a.on("click",function(e){e.preventDefault();var a=$(this),n=!0,o={};$(".upload-data").each(function(t,e){var a=$(e),r=a.val().trim();return""==r?void(n=!1):void(o[a.attr("name")]=r)}),$(".upload-data-img").each(function(t,e){var a=$(e),r=a.attr("src").trim();return""==r?void(n=!1):void(o.images?o.images+=";"+r:o.images=r)}),0===$(".upload-data-img").length&&(n=!1);var r=t();return r?o.carDescription=r:n=!1,n?(console.log(o),a.prop("disabled",!0).text("正在提交").addClass("sending"),void $.ajax({url:"/keeper/car/add",type:"post",dataType:"json",data:o}).fail(function(){alert("提交失败, 请重试"),a.prop("disabled",!1).text("提交新闻").removeClass("sending"),console.log("error")}).done(function(t){t.state?(a.text("提交成功").removeClass("sending"),$$.modal.show({title:"提示",content:"提交成功，点击确定跳转到列表页面",type:"info",confirm:function(){window.location.href="/keeper/car/list/1"}})):($$.modal.show({title:"提示",content:"提交失败，请重试",type:"info"}),a.text("提交表单").removeClass("sending").prop("disabled",!1))})):void alert("信息未填写完整")})});