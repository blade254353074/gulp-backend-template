$(function(){function e(){return v.getContent()}for(var a={models:[{id:"0001",name:"货车"},{id:"0002",name:"皮卡"},{id:"0003",name:"面包车"},{id:"0004",name:"房车"},{id:"0005",name:"小型车"},{id:"0006",name:"微型车"},{id:"0007",name:"紧凑型车"},{id:"0008",name:"中等型车"},{id:"0009",name:"高级型车"},{id:"0010",name:"豪华型车"},{id:"0011",name:"三厢型车"},{id:"0012",name:"CDV"},{id:"0013",name:"MPV"},{id:"0014",name:"SUV"}],trans:[{id:"0001",name:"手动"},{id:"0002",name:"半自动（AMT）"},{id:"0003",name:"自动（AT）"},{id:"0004",name:"手自一体"},{id:"0005",name:"无极变速（CVT）"},{id:"0006",name:"双离合（DSG）"},{id:"0007",name:"其他"}],drivenMode:[{id:"0001",name:"前置前驱（FF）"},{id:"0002",name:"前置后驱（FR）"},{id:"0003",name:"前置四驱"},{id:"0004",name:"中置后驱（MR）"},{id:"0005",name:"中置四驱"},{id:"0006",name:"后置后驱（RR）"},{id:"0007",name:"后置四驱"}]},n="",t="",d="",i=0;i<a.models.length;i++)n+='<option value="'+a.models[i].id+'">'+a.models[i].name+"</option>";for(var i=0;i<a.drivenMode.length;i++)t+='<option value="'+a.drivenMode[i].id+'">'+a.drivenMode[i].name+"</option>";for(var i=0;i<a.trans.length;i++)d+='<option value="'+a.trans[i].id+'">'+a.trans[i].name+"</option>";$("#modelsId").append(n),$("#drivenModelId").append(t),$("#transmissionId").append(d);var o=$("#seriesSelect"),r=$("#submit");o.on("change",function(){r.prop("disabled",!this.value)});var l=$("#imageGallery"),s=$("#imageUpload"),m=s.parent("a"),c=l.children("img").length;s.ajaxfileupload({action:"/image/upload",onStart:function(){s.prop("diaabled",!0),m.addClass("sending disabled")},onComplete:function(e){9>c&&(s.prop("disabled",!1),m.removeClass("disabled")),m.removeClass("sending"),e.state&&(l.append('<img src="'+e.url+'" class="img-thumbnail upload-data-img">'),c++)}});var p=$("#carVerList"),u=p.children("tr").length;$("#carVerAdd").on("click",function(e){e.preventDefault(),html='<tr><td><input name="carverList['+u+'].carVerInfo" type="text" class="form-control upload-data"></td><td><input name="carverList['+u+'].carVerLink" type="text" class="form-control upload-data" placeholder="http://www.xxx.com"></td><td><input name="carverList['+u+'].carPriceDiff" type="text" class="form-control upload-data" placeholder="-23.0"></td><td><button class="delete btn btn-default btn-sm"><span class="icon icon-remove"></span></button></td></tr>',u++,p.append(html)}),p.on("click",".delete",function(e){e.preventDefault(),$(this).closest("tr").remove()});var v=UM.getEditor("ueditor");r.on("click",function(a){a.preventDefault();var n=$(this),t=!0,d={},i=n.data("id");$(".upload-data").each(function(e,a){var n=$(a),i=n.val().trim();return""==i?void(t=!1):void(d[n.attr("name")]=i)}),$(".upload-data-img").each(function(e,a){var n=$(a),i=n.attr("src").trim();return""==i?void(t=!1):void(d.images?d.images+=";"+i:d.images=i)}),0===$(".upload-data-img").length&&(t=!1);var o=e();return o?d.carDescription=o:t=!1,t?(d._method="PUT",console.log(d),n.prop("disabled",!0).text("正在提交").addClass("sending"),void $.ajax({url:"/keeper/car/"+i,type:"POST",dataType:"json",data:d}).fail(function(){alert("提交失败, 请重试"),n.prop("disabled",!1).text("提交新闻").removeClass("sending"),console.log("error")}).done(function(e){e.state?(n.text("提交成功").removeClass("sending"),$$.modal.show({title:"提示",content:"提交成功，点击确定跳转到列表页面",type:"info",confirm:function(){window.location.href="/keeper/car/list/1"}})):($$.modal.show({title:"提示",content:"提交失败，请重试",type:"info"}),n.text("提交表单").removeClass("sending").prop("disabled",!1))})):void alert("信息未填写完整")})});